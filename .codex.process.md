# Codex Process Guidelines  
These rules define how Codex should behave while working inside this repository.  
They apply to all feature branches, bug fixes, refactors, and documentation updates.

Unless a prompt explicitly overrides a rule, the instructions in this file always apply.

---

## 1. General Behavior  
- Work in **one coherent pass** per prompt.  
- Don’t ask for file-by-file confirmation unless you detect something that is clearly inconsistent, ambiguous, or unsafe.  
- When a user prompt references changes across multiple files, Codex should perform all changes during one editing run.  
- Never modify files unrelated to the request.  
- When interpreting instructions, always follow the **intent** of the user’s request, even if the existing structure differs slightly.

---

## 2. Branching Workflow  
When a prompt instructs Codex to implement changes:

1. **Create and switch to a new branch**  
   - Naming: `feature/<name>` or `fix/<name>` depending on the task.  
   - If the branch already exists, reuse it unless the prompt states otherwise.

2. **Perform all edits**  
   - Modify each file needed to fulfill the request.  
   - Maintain consistent formatting, naming, spacing, and architecture patterns.  
   - Follow all domain rules in `codex.md`.

3. **Use a single commit** unless explicitly told to split work.

---

## 3. Editing Rules  
- Prefer minimally invasive edits that preserve existing architecture.  
- If small refactors are required to maintain consistency, perform them automatically.  
- Never introduce temporary or placeholder code unless explicitly requested.  
- Prefer extension methods, small helpers, and cohesive architectural patterns.  
- Use existing naming conventions and avoid introducing new patterns unless necessary.

---

## 4. File Creation & Organization  
- Place new Swift files in logical groups:  
  - `Models/`  
  - `Views/`  
  - `ViewModels/`  
  - `Services/`  
  - `Helpers/`  
  - `Theme/`  
- When adding new UI components, reuse SGTheme, spacing constants, and typography established in `codex.md` and the theme layer.  
- When adding new models, ensure they are annotated with `@Model` and follow the project’s SwiftData style.

---

## 5. Safety & Error Handling  
- If a prompt requests something that contradicts app architecture or domain rules, Codex must warn the user once before proceeding.  
- If a git operation fails (permissions, conflicts, missing branch), Codex must:  
  - Stop the git sequence  
  - Report the issue  
  - Suggest the minimal user action needed  
- Do not attempt to resolve merge conflicts automatically unless explicitly asked.

---

## 6. Git & Pull Request Behavior  
Unless a prompt explicitly instructs: **“do not commit,” “do not push,” or “no PR,”** Codex must automatically perform the full git workflow.

### 6.1 Automatic Commit  
- After completing all edits, prepare a single commit.  
- Commit message should be clear and descriptive.  
- Do not split into multiple commits unless the prompt requires it.  
- Never use force-push or history rewriting.

### 6.2 Automatic Push  
- Push the feature branch to remote.  
- If the tool requires user approval for shell commands, request approval once and proceed.  
- Do not push if the prompt says not to.

### 6.3 Pull Request Draft Output  
After pushing, Codex must generate a **PR-ready summary comment inside a fenced code block**.  
The PR comment must include:
- Title  
- High-level summary  
- Implementation details  
- Any assumptions or notes  
- Validation steps for testing  

Codex should not create an actual PR unless explicitly asked.

### 6.4 Branch Safety  
- Never merge branches automatically.  
- Never force-push.  
- Never switch back to `main` unless the user explicitly requests it.

### 6.5 Error Handling  
If a git command fails:
- Stop further git actions  
- Report the issue  
- Suggest how the user can manually resolve it  

### 6.6 Exceptions  
Codex should NOT commit/push when:
- Prompt explicitly forbids it  
- Work is exploratory or conceptual  
- User requests proposals, architecture discussions, or code reviews

---

## 7. Testing & Validation Before Commit  
Before committing and pushing, Codex must verify:

- Project builds successfully  
- No syntax errors  
- Modified files are consistent with SGTheme, layout conventions, and domain rules  
- No unused imports or stray debug code  
- Data model changes compile with SwiftData  
- Views use correct modifiers and view structures  
- No accidental changes were made outside the scope of the prompt  

If Codex cannot validate logically, it must notify the user.

---

## 8. Documentation  
- Update relevant documentation when new features introduce new concepts.  
- Documentation changes count as part of the same commit unless the user requests otherwise.

---

## 9. Tone & Comments  
- Code comments should be short, clear, and purposeful.  
- Avoid over-explanation.  
- No generated boilerplate comments.  
- Favor naming clarity over excessive documentation.

---

## 10. Completion  
When finished, Codex must:  
1. Complete all edits  
2. Validate the build conceptually  
3. Commit  
4. Push  
5. Provide a PR summary block  
6. Wait for further instructions

Unless the user explicitly instructs otherwise.
